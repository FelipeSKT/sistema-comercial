<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Novo Cliente</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="cabecalho-topo">
    <nav class="links-navegacao">
        <a href="/index.html" style="text-decoration: underline;">Novo Cliente</a>
        <a href="/clientes-lista.html">Lista de Clientes</a> <a href="/produtos.html">Gerir Produtos</a>
        <a href="/estoque.html">Gerir Estoque</a>
        <a href="/vendas.html">Vendas (PDV)</a>
    </nav>
    <div class="logo-area">
        <img src="/img/logo.png" alt="Logo" class="logo-imagem">
    </div>
</header>

<br>

<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 id="tituloPagina">Cadastro de Cliente</h1>
        <a href="/clientes-lista.html" style="color: #007bff; text-decoration: none; font-weight: bold;">Ver Lista ‚û°</a>
    </div>

    <input type="hidden" id="campoId">

    <div class="tab-container">
        <button class="tab-botao ativo" onclick="mudarTab('FISICA')" id="tabFisica">Pessoa F√≠sica</button>
        <button class="tab-botao" onclick="mudarTab('JURIDICA')" id="tabJuridica">Pessoa Jur√≠dica</button>
    </div>

    <br>

    <div class="full-width">
        <label>Nome Completo / Raz√£o Social:</label>
        <input type="text" id="campoNome">
    </div>

    <div class="form-row">
        <div>
            <label>Contato (Tel/Cel):</label>
            <input type="text" id="campoContato" maxlength="15">
        </div>
        <div>
            <label>Email:</label>
            <input type="email" id="campoEmail">
        </div>
    </div>

    <div id="areaFisica">
        <div class="full-width">
            <label>CPF:</label>
            <input type="text" id="campoCpf" maxlength="14" placeholder="000.000.000-00">
        </div>
    </div>

    <div id="areaJuridica" class="hidden">
        <div class="address-row">
            <div>
                <label>CNPJ:</label>
                <input type="text" id="campoCnpj" maxlength="18">
            </div>
            <div>
                <label>Insc. Estadual:</label>
                <input type="text" id="campoIE">
            </div>
            <div>
                <label>Insc. Municipal:</label>
                <input type="text" id="campoIM">
            </div>
        </div>
    </div>

    <h3 style="border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-top: 30px; margin-bottom: 20px; color: #555;">üìç Endere√ßo</h3>

    <div class="address-row">
        <div>
            <label>CEP:</label>
            <input type="text" id="campoCep" maxlength="9" onblur="buscarCep(this.value)">
        </div>
        <div>
            <label>Cidade:</label>
            <input type="text" id="campoCidade">
        </div>
        <div>
            <label>Estado (UF):</label>
            <input type="text" id="campoEstado" maxlength="2">
        </div>
    </div>

    <div class="street-row">
        <div>
            <label>Logradouro (Rua/Av):</label>
            <input type="text" id="campoEndereco">
        </div>
        <div>
            <label>N√∫mero:</label>
            <input type="text" id="campoNumeroEnd">
        </div>
    </div>

    <div class="form-row">
        <div>
            <label>Bairro:</label>
            <input type="text" id="campoBairro">
        </div>
        <div>
            <label>Complemento:</label>
            <input type="text" id="campoComplemento">
        </div>
    </div>

    <br>
    <button id="btnSalvar" onclick="cadastrar()" style="width: 100%; height: 50px; font-size: 18px;">Salvar Cliente</button>
</div>

<script>
    let tipoAtual = 'FISICA';

    function mudarTab(tipo) {
        tipoAtual = tipo;
        document.getElementById('tabFisica').className = tipo === 'FISICA' ? 'tab-botao ativo' : 'tab-botao';
        document.getElementById('tabJuridica').className = tipo === 'JURIDICA' ? 'tab-botao ativo' : 'tab-botao';
        if (tipo === 'FISICA') {
            document.getElementById('areaFisica').classList.remove('hidden');
            document.getElementById('areaJuridica').classList.add('hidden');
        } else {
            document.getElementById('areaFisica').classList.add('hidden');
            document.getElementById('areaJuridica').classList.remove('hidden');
        }
    }

    function cadastrar() {
        // Valida√ß√µes b√°sicas e limpeza
        let dados = {
            id: null, // Cadastro novo √© sempre null
            tipo: tipoAtual,
            nome: document.getElementById("campoNome").value,
            contato: document.getElementById("campoContato").value,
            email: document.getElementById("campoEmail").value,
            cep: document.getElementById("campoCep").value,
            endereco: document.getElementById("campoEndereco").value,
            numeroEndereco: document.getElementById("campoNumeroEnd").value,
            bairro: document.getElementById("campoBairro").value,
            complemento: document.getElementById("campoComplemento").value,
            cidade: document.getElementById("campoCidade").value,
            estado: document.getElementById("campoEstado").value,
        };

        if(!dados.nome || !dados.contato) { alert("Nome e Contato s√£o obrigat√≥rios!"); return; }

        if (tipoAtual === 'FISICA') {
            dados.cpf = document.getElementById("campoCpf").value;
            if(!dados.cpf) { alert("CPF Obrigat√≥rio"); return; }
        } else {
            dados.cnpj = document.getElementById("campoCnpj").value;
            dados.inscricaoEstadual = document.getElementById("campoIE").value;
            dados.inscricaoMunicipal = document.getElementById("campoIM").value;
            if(!dados.cnpj) { alert("CNPJ Obrigat√≥rio"); return; }
        }

        fetch('/cliente', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(dados)
        }).then(resp => resp.text()).then(msg => {
            alert(msg);
            location.reload(); // Recarrega para limpar
        });
    }

    // Busca CEP
    function buscarCep(cep) {
        let cleanCep = cep.replace(/\D/g, '');
        if(cleanCep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cleanCep}/json/`).then(r => r.json()).then(d => {
                if(!d.erro) {
                    document.getElementById('campoEndereco').value = d.logradouro;
                    document.getElementById('campoBairro').value = d.bairro;
                    document.getElementById('campoCidade').value = d.localidade;
                    document.getElementById('campoEstado').value = d.uf;
                    document.getElementById('campoNumeroEnd').focus();
                }
            });
        }
    }

    // M√°scaras (Simplificado)
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("campoContato").oninput = function() { this.value = this.value.replace(/\D/g,"").replace(/^(\d{2})(\d)/g,"($1) $2").replace(/(\d)(\d{4})$/,"$1-$2").substring(0, 15); }
        document.getElementById("campoCpf").oninput = function() { this.value = this.value.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2").substring(0, 14); }
        document.getElementById("campoCnpj").oninput = function() { this.value = this.value.replace(/\D/g,"").replace(/^(\d{2})(\d)/,"$1.$2").replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3").replace(/\.(\d{3})(\d)/,".$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0, 18); }
        document.getElementById("campoCep").oninput = function() { this.value = this.value.replace(/\D/g,"").replace(/^(\d{5})(\d)/,"$1-$2").substring(0, 9); }
    });
</script>
</body>
</html>